<header class="bg-[#444444] text-steel shadow">
  <div class="container mx-auto flex justify-between items-center p-4 relative">
    <!-- Left: Logo and title -->
    <a href="/" class="relative flex items-center space-x-2 hover:text-cs-blue active:text-cs-green group">
      <img src="/static/images/coopshaplogo-large.png" alt="Logo" class="h-8 w-auto max-h-[50px] filter transition-all group-hover:brightness-75 group-hover:saturate-150">
      <span class="hidden md:inline text-2xl font-bold">CoopShap</span>
    </a>

   <!-- Centered: Navigation links -->
  <nav class="hidden md:flex absolute left-1/2 transform -translate-x-1/2 space-x-1">
    <a href="/about" class="px-4 py-2 hover:text-cs-blue active:text-cs-green hover:bg-[#333333] rounded">About</a>
    
    <!-- Courses dropdown for desktop -->
    <div class="relative" id="courses-dropdown-container">
      <!-- The Courses button now links to /courses -->
      <a href="/courses" 
        id="courses-button" 
        class="inline-block px-4 py-2 hover:text-cs-blue active:text-cs-green hover:bg-[#333333] rounded">
        Courses
      </a>
      <!-- Dropdown -->
      <div id="courses-dropdown" 
          class="absolute hidden mt-2 w-48 bg-[#333333] text-steel rounded shadow-lg transition-opacity opacity-0 z-50">
        <a href="/courses/ECE1181" class="block px-4 py-2 hover:text-cs-blue active:text-cs-green hover:bg-[#3A3A3A] rounded">ECE1181</a>
        <a href="/courses/ECE2170" class="block px-4 py-2 hover:text-cs-blue active:text-cs-green hover:bg-[#3A3A3A] rounded">ECE2170</a>
        <a href="/courses/conquering-the-terminal" class="block px-4 py-2 hover:text-cs-blue active:text-cs-green hover:bg-[#3A3A3A] rounded">Conquering the Terminal</a>
      </div>
    </div>

    <a href="/projects" class="px-4 py-2 hover:text-cs-blue active:text-cs-green hover:bg-[#333333] rounded">Projects</a>
  </nav>

    <!-- Right: Theme toggle and mobile menu button -->
    <div class="flex items-center space-x-4">
      <button id="theme-toggle" class="flex items-center focus:outline-none hover:text-cs-blue active:text-cs-green hover:bg-[#333333] rounded-lg px-2 py-2">
        <svg id="theme-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path d="M3.32031 11.6835C3.32031 16.6541 7.34975 20.6835 12.3203 20.6835C16.1075 20.6835 19.3483 18.3443 20.6768 15.032C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834C12.3497 15.6834 8.32031 11.654 8.32031 6.68342C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996C5.65605 4.66028 3.32031 7.89912 3.32031 11.6835Z"></path>
        </svg>
      </button>
      <button id="mobile-menu-button" class="md:hidden flex items-center focus:outline-none hover:text-cs-blue active:text-cs-green">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile navigation menu -->
  <nav id="mobile-menu" class="hidden md:hidden bg-[#333333] text-steel">
    <a href="/about" class="block px-4 py-2 hover:bg-cs-blue active:bg-cs-green">About</a>
    <button id="mobile-courses-button" class="block w-full text-left px-4 py-2 hover:bg-cs-blue active:bg-cs-green">Courses</button>
    <div id="mobile-courses-dropdown" class="hidden bg-[#3A3A3A]">
      <a href="/courses/ECE1181" class="block px-6 py-2  hover:bg-cs-blue active:bg-cs-green">ECE1181</a>
      <a href="/courses/ECE2170" class="block px-6 py-2  hover:bg-cs-blue active:bg-cs-green">ECE2170</a>
      <a href="/courses/conquering-the-terminal" class="block px-6 py-2  hover:bg-cs-blue active:bg-cs-green">Conquering the Terminal</a>
    </div>
    <a href="/projects" class="block px-4 py-2 hover:bg-cs-blue active:bg-cs-green">Projects</a>
    <a href="/posts" class="block px-4 py-2 hover:bg-cs-blue active:bg-cs-green">Posts</a>
  </nav>
</header>

<script>
  // Dropdown functionality for Courses (Desktop)
  const coursesButton = document.getElementById('courses-button');
  const coursesDropdown = document.getElementById('courses-dropdown');
  const coursesDropdownContainer = document.getElementById('courses-dropdown-container');

  // Show dropdown when hovering over the Courses button or the dropdown itself
  coursesButton.addEventListener('mouseenter', () => {
    coursesDropdown.classList.remove('hidden');
    coursesDropdown.classList.add('opacity-100');
  });

  // Hide dropdown after mouse leaves the button or the dropdown itself
  coursesButton.addEventListener('mouseleave', (event) => {
    // Ensure that the dropdown stays open when hovering over menu items
    if (!coursesDropdown.contains(event.relatedTarget)) {
      setTimeout(() => {
        if (!coursesDropdown.matches(':hover') && !coursesButton.matches(':hover')) {
          coursesDropdown.classList.add('hidden');
          coursesDropdown.classList.remove('opacity-100');
        }
      }, 200); // Delay to allow hovering time
    }
  });

  // Keep the dropdown open when hovering over the dropdown itself
  coursesDropdown.addEventListener('mouseenter', () => {
    coursesDropdown.classList.remove('hidden');
    coursesDropdown.classList.add('opacity-100');
  });

  // Hide the dropdown after leaving the dropdown
  coursesDropdown.addEventListener('mouseleave', (event) => {
    if (!coursesButton.contains(event.relatedTarget)) {
      setTimeout(() => {
        coursesDropdown.classList.add('hidden');
        coursesDropdown.classList.remove('opacity-100');
      }, 200); // Delay to allow hovering time
    }
  });

  // Mobile Menu Button Functionality
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  const mobileCoursesButton = document.getElementById('mobile-courses-button');
  const mobileCoursesDropdown = document.getElementById('mobile-courses-dropdown');

  // Toggle mobile menu visibility
  mobileMenuButton?.addEventListener('click', () => {
    mobileMenu.classList.toggle('hidden');
  });

  // Toggle mobile courses dropdown visibility
  mobileCoursesButton?.addEventListener('click', () => {
    mobileCoursesDropdown.classList.toggle('hidden');
  });

  // Theme toggle functionality
  const themeToggle = document.getElementById('theme-toggle');
  const themeIcon = document.getElementById('theme-icon');

  // Function to check and set the initial theme
  function setInitialTheme() {
    const userPrefersDark = localStorage.getItem('theme') === 'dark';
    const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

    // If user has a preference saved, use it, else default to dark mode
    if (userPrefersDark || (!localStorage.getItem('theme') && systemPrefersDark)) {
      document.documentElement.classList.add('dark');
      themeIcon.innerHTML = '<path d="M12 3v1m0 16v1m9-9h1M3 12H2m16.24-7.76l-.707.707M5.636 18.364l-.707.707M18.364 18.364l-.707-.707M5.636 5.636l-.707-.707M12 6a6 6 0 100 12 6 6 0 000-12z" />';
    } else {
      document.documentElement.classList.remove('dark');
      themeIcon.innerHTML = '<path d="M3.32031 11.6835C3.32031 16.6541 7.34975 20.6835 12.3203 20.6835C16.1075 20.6835 19.3483 18.3443 20.6768 15.032C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834C12.3497 15.6834 8.32031 11.654 8.32031 6.68342C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996C5.65605 4.66028 3.32031 7.89912 3.32031 11.6835Z"></path>';
    }
  }

  // Call the function to set the initial theme when the page loads
  setInitialTheme();

  // Theme toggle functionality on button click
  themeToggle?.addEventListener('click', () => {
    document.documentElement.classList.toggle('dark');
    if (document.documentElement.classList.contains('dark')) {
      localStorage.setItem('theme', 'dark');
      themeIcon.innerHTML = '<path d="M12 3v1m0 16v1m9-9h1M3 12H2m16.24-7.76l-.707.707M5.636 18.364l-.707.707M18.364 18.364l-.707-.707M5.636 5.636l-.707-.707M12 6a6 6 0 100 12 6 6 0 000-12z" />';
    } else {
      localStorage.setItem('theme', 'light');
      themeIcon.innerHTML = '<path d="M3.32031 11.6835C3.32031 16.6541 7.34975 20.6835 12.3203 20.6835C16.1075 20.6835 19.3483 18.3443 20.6768 15.032C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834C12.3497 15.6834 8.32031 11.654 8.32031 6.68342C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996C5.65605 4.66028 3.32031 7.89912 3.32031 11.6835Z"></path>';
    }
  });
</script>
