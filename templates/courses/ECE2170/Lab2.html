{% extends 'base.html' %}
{% block content %}
<body class="bg-gray-100 dark:text-steel text-[#222222]">
    <!-- Blog Post Wrapper -->
    <div class="max-w-screen-md px-4 py-8 mx-auto">
        <!-- Thinner Centered Bar -->
        <div class="dark:bg-[#444444] bg-[#CCCCCC] rounded-3xl shadow-2xl dark:shadow-white p-6 mx-auto">
            <!-- Title Section -->
            <div class="text-center">
                <h1 class="text-6xl font-extrabold leading-tight text-cs-green">
                    Multipath Fading with MATLAB
                </h1>
                <h2 class="text-2xl text-bold leading-tight text-cs-green">
                    Learn how to use complex exponentials in MATLAB to solve real problems
                </h1>
                 <!-- Separator -->
                <div class="h-px bg-cs-green my-6"></div>
                <a href="#overview" class="inline-block bg-cs-blue hover:bg-blue-700  hover:underline px-4 py-1 rounded-lg font-medium transition-all duration-300 border-[#333333] border">
                    Overview
                </a> >>
                <a href="#matlab" class="inline-block bg-cs-blue hover:bg-blue-700 hover:underline px-4 py-1 rounded-lg font-medium transition-all duration-300 border-[#333333] border">
                    MATLAB
                </a> >>
                <a href="#sin" class="inline-block bg-cs-blue hover:bg-blue-700 hover:underline px-4 py-1 rounded-lg font-medium transition-all duration-300 border-[#333333] border">
                    Sinusoids
                </a> >>
                <a href="#conclusion" class="inline-block bg-cs-blue hover:bg-blue-700 hover:underline px-4 py-1 rounded-lg font-medium transition-all duration-300 border-[#333333] border">
                    Conclusion
                </a> >>
                <a href="#assignment" class="inline-block bg-cs-blue hover:bg-blue-700 hover:underline px-4 py-1 rounded-lg font-medium transition-all duration-300 border-[#333333] border">
		            Assignment
                </a>
            </div>

<div class="h-px bg-cs-green my-6"></div><h1 id="overview" class="text-4xl font-extrabold">Overview</h1><br/>
<p class="leading-relaxed text-lg">Welcome to ECE 2170 Lab 2. Here, you will learn how to deal with complex exponentials in MATLAB. If you need a refesher or rexplanation of how complex exponentials work, let TA Cooper know. Once you have the fundamentals down, you will use your skills to solve a common problem of "multipath fading."</p><br/>

<div class="h-px bg-cs-green my-6"></div><h1 id="matlab" class="text-4xl font-extrabold">The MATLAB Syntax</h1><br/>
<p class="leading-relaxed text-lg">When writing code that uses complex exponentials in MATLAB, you can declare them using any of the following syntaxes:</p>
<p class="leading-relaxed text-lg"><ol class="list ml-16 text-lg"><li>1+j</li></p>
<p class="leading-relaxed text-lg"><li>1+1j</li></p>
<p class="leading-relaxed text-lg"><li>exp(j*pi)</li></p></ol><br/>

<p class="leading-relaxed text-lg">However, you will find it most useful to use the exp() version in this lab.</p><br/>

<p class="leading-relaxed text-lg">MATLAB also has many built-in functions for working with complex numbers. Here is a list of functions and what they do:</p><br/>

<p class="leading-relaxed text-lg"><code class="bg-cs-blue px-1 rounded shadow-lg text-base">conj(x)</code>: Returns the complex conjugate of the number (flips the sign of the imaginary part)</p>
<p class="leading-relaxed text-lg"><code class="bg-cs-blue px-1 rounded shadow-lg text-base">abs(x)</code>: Returns the magnitude of the complex number</p>
<p class="leading-relaxed text-lg"><code class="bg-cs-blue px-1 rounded shadow-lg text-base">angle(x)</code>: Returns the angle/phase of the number</p>
<p class="leading-relaxed text-lg"><code class="bg-cs-blue px-1 rounded shadow-lg text-base">real(x)</code>: Returns only the real part of the number (e.x. "2" in the complex number "2+9j")</p>
<p class="leading-relaxed text-lg"><code class="bg-cs-blue px-1 rounded shadow-lg text-base">imag(x)</code>: Returns only the imaginary part of the number (e.x. "9j" in the complex number "2+9j")</p>

<p class="leading-relaxed text-lg">If you supply the above functions with a vector (array) of complex numbers, it will perform the operation on each number in the array.</p><br/>

<p class="leading-relaxed text-lg">Also, remember to try and use vectors instead of loops when working in MATLAB. To do so, you want to first generate a time series with <code class="bg-cs-blue px-1 rounded shadow-lg text-base">linspace</code>, then apply your function to the time vector. This will generate the result calculated for every time instance without needing to loop.</p><br/>

<div class="h-px bg-cs-green my-6"></div><h1 id="sin" class="text-4xl font-extrabold">Adding Sinusoids of the Same Frequency</h1><br/>
<p class="leading-relaxed text-lg">Quick reminder on working with complex sinusoids. Any sinusoid can be represented as the real part of a complex sinuoid of the same frequency, with phase and amplitude dependent on the complex amplitude of the complex exponential. If you add multiple sinusoids of the same frequency, the resulting wave has the same frequency, but a different phase and amplitude as the originals. This new sinusoid is very hard to calculate using real sinusoids (e.x. cos(300pi)), but is very easy to calculate when using complex sinusoids, since you simply add the complex amplitudes of all the inputs.</p><br/>

<p class="leading-relaxed text-lg">If the sinusoids have different frequencies, you cannot directly reduce the result into a single real or complex term. The new signal will exist as a raw sum of the original signals with a total frequency as the fundamental frequency of the inputs.</p><br/>

<div class="h-px bg-cs-green my-6"></div><h1 id="overview" class="text-4xl font-extrabold">Functions in MATLAB</h1><br/>
<p class="leading-relaxed text-lg">Functions in MATLAB work like they do in any other language. They can also return multiple values. Here is an example of a function declaration in MATLAB:</p><br/>
<pre class="dark:bg-gray-600 bg-gray-400 rounded-lg p-4 shadow-2xl overflow-auto">
function [xx, tt] = gen_cos(ff,dur)
    tt = 0 : 1/(100*ff) : dur;
    xx = cos(2 * pi * ff * tt);
end
</pre><br/>
<p class="leading-relaxed text-lg">The function takes 2 parameters: <code class="bg-cs-blue px-1 rounded shadow-lg text-base">ff</code> for frequency and <code class="bg-cs-blue px-1 rounded shadow-lg text-base">dur</code> for duration. It then calculates a time series, <code class="bg-cs-blue px-1 rounded shadow-lg text-base">tt</code>, which is 100 samples per period for <code class="bg-cs-blue px-1 rounded shadow-lg text-base">dur</code> seconds. Finally, it calculates the cosine of each of those values and places it in a vector called <code class="bg-cs-blue px-1 rounded shadow-lg text-base">xx</code>. Note that, unlike other languages, you do not return values directly at the end of a function. In the function header, you declare the variables you want to return, in order, and those variables are automatically returned once the function ends (here, <code class="bg-cs-blue px-1 rounded shadow-lg text-base">xx</code> and <code class="bg-cs-blue px-1 rounded shadow-lg text-base">tt</code>).</p><br/>


<div class="h-px bg-cs-green my-6"></div><h1 id="conclusion" class="text-4xl font-extrabold">Conclusion</h1><br/>
<p class="leading-relaxed text-lg">Here, you learned the basics of working with complex exponentials in MATLAB. Please let TA Cooper know if you have any questions or feedback on how to improve this lab for the future. All that's left is to finish the two tasks below and write your lab report. Soft deadline for this lab report is before the start of next weeks lab. Let me know if you need an extension.</p><br/>

<div class="h-px bg-cs-green my-6"></div><h1 id="assignment" class="text-4xl font-extrabold">Assignment</h1><br/>
<p class="leading-relaxed text-lg">The assignment portion of the lab contains all instructions and requirements for your lab report. Any challenges or questions in the sections above were hypothetical and just for your practice. On your lab report, you only need to respond to the assignments in this section. Remember that you can check out the <a href="lab-guide" class="text-lg text-cs-blue hover:text-blue-700 underline">Lab Report Guide</a> to see the expectations the TAs have of your lab reports.</p><br/>

<h2 class="text-2xl text-bold underline text-cs-green">Task 1</h2>
<p class="leading-relaxed text-lg">Write a MATLAB function that adds all the input sinusoids and returns both the result and the time vector.</p><br/>

<p class="leading-relaxed text-lg">Additional Requirements:</p>
<p class="leading-relaxed text-lg">- The function must take the following as inputs: vector of frequencies, vector of complex amplitudes, number of samples per second, duration of time to sample, and the start time.</p>
<p class="leading-relaxed text-lg">- You should avoid using loops as much as possible, but you will need one for this task.</p><br/>

<p class="leading-relaxed text-lg">Assumptions:</p>
<p class="leading-relaxed text-lg">- You may use the following as a start for your code. Note that lines that begin with a <code class="bg-cs-blue px-1 rounded shadow-lg text-base">%</code> are comments, just explianing the inputs and outputs.</p><br/>
<pre class="dark:bg-gray-600 bg-gray-400 rounded-lg p-4 shadow-2xl overflow-auto">
function [xx,tt] = syn_sin(fk, Xk, fs, dur, tstart)
    %SYN_SIN Function to synthesize a sum of cosine waves
    % usage:
    % [xx,tt] = syn_sin(fk, Xk, fs, dur, tstart)
    % fk = vector of frequencies
    % (these could be negative or positive)
    % Xk = vector of complex amplitudes: Amp*eË†(j*phase)
    % fs = the number of samples per second for the time axis
    % dur = total time duration of the signal
    % tstart = starting time (default is zero, if you make this input optional)
    % xx = vector of sinusoidal values
    % tt = vector of times, for the time axis
    %
    % Note: fk and Xk must be the same length.
    % Xk(1) corresponds to frequency fk(1),
    % Xk(2) corresponds to frequency fk(2), etc.
end
</pre><br/>

<p class="leading-relaxed text-lg">Expected Outputs:</p>
<p class="leading-relaxed text-lg">- You should show 2 examples of your function working. You can use any inputs with at least 3 sinusoids for your examples.</p><br/>


<h2 class="text-2xl text-bold underline text-cs-green">Task 2</h2>
<p class="leading-relaxed text-lg">Multipath Fading</p><br/>
<p class="leading-relaxed text-lg">"In a mobile radio system (e.g., cell phones or AM radio), there is one type of degradation that is a common problem. This is the case of multipath fading caused by reflections of the radio waves which interfere destructively at some locations. Consider the scenario diagrammed in Fig. 1 where a vehicle traveling on the roadway receives signals from two sources: directly from the transmitter and reflections from another object such as a large building. This multipath problem can be modeled easily with sinusoids. The total received signal at the vehicle is the sum of two signals which are themselves delayed versions of the transmitted signal, s(t)."</p><br/>
<div class="flex justify-center">
    <img src="/static/images/featured/ECE2170/multipath.png" alt="Image not Loading, see TA" class="md:w-4/5 w-1/2 rounded-lg shadow-lg">
</div>
<p class="leading-relaxed text-lg">Figure 1: Scenario for multipath in mobile radio. A vehicle traveling on the roadway (to the right) receives signals from two sources: the transmitter and a reflector located at (dxr, dyr). </p><br/>

<p class="leading-relaxed text-lg">You can reframe the problem as follows:</p>
<p class="leading-relaxed text-lg">- Imagine a car listening to the radio driving through a city. The radio wave can take multiple paths to get to the car: directly, or by reflecting off of a building. Each one of these paths takes a different amount of time to reach the car, and when the multiple signals arrive, they are combined (added) into one resulting wave. The two waves are exactly the same, just with a different phase between them. Your job is to find the specific spots on the road where the radio cuts out due to the original and reflected waves canceling out.</p><br/>

<p class="leading-relaxed text-lg">Include the following in your lab report:</p>
<ol class="list-decimal ml-12 text-lg space-y-2"><li>The delay, in seconds, of each signal can be calculated by the distance the signal travels divided by the speed of light. Write a MATLAB code that calculates the time delay each signal experiences, based off the diagram above. Make sure the code can take inputs for where the car is (dx, 0), where the transmitter is (0, dy), and where the reflector is (dxr, dyr).</li>

<li>Note that, when the signal bounces off the building (reflector), it gets a 180 degree phase shift. Explain how this affects the complex amplitude of the signal.</li>

<li>Write a function that takes the parameters <code class="bg-cs-blue px-1 rounded shadow-lg text-base">dx, dy, dxr, dyr</code> from part 1, as well as a frequency. The function should use your work from parts 1 and 2 to add the two delayed sinusoids, accounting for the phase flip of the reflected signal. You may be able to use your function from Task 1. The function should return only the magnitude (a.k.a amplitude, not complex amplitude) of the resulting signal.</li>

<li>Assuming that the transmitter is at (0, 1500) and the reflector is at (100, 900), find the amplitude of a 150 MHz signal at each meter the car travels from 0 to 300 meters.</li>

<li>Plot your data from part 4, where the x axis is the position of the car (0 to 300) and the y axis is the amplitude of the signal (between 0 and 2).</li>

<li>Explain what the plot signifies and any points of interest. At what positions will the radio be completely canceled out? </li></ol>
    
        </div></div>
<!-- Feedback Box -->
    <div id="feedback-box" class="fixed hidden right-0 top-1/2 transform -translate-y-1/2 bg-gray-200 dark:bg-[#444444] border-l-4 border-b-4 border-[#E0E0E0] dark:border-[#3B3B3B] rounded-l-xl shadow-lg w-64 p-4 z-50">
        <h2 class="font-bold text-lg dark:text-white text-gray-800 mb-2 text-center">Feedback</h2>
        <textarea id="feedback-text" class="w-full p-2 border rounded-md dark:bg-[#333333] dark:text-steel text-gray-800" rows="4" placeholder="Feedback, corrections, feature ideas, comments, etc."></textarea>
        <button id="submit-feedback" class="mt-2 w-full bg-cs-blue hover:bg-cs-green text-white py-2 px-4 rounded-md">Submit</button>
    </div>

    <!-- Toggle Tab -->
    <button id="feedback-toggle" class="fixed top-1/2 transform -translate-y-1/2 right-0 md:right-64 bg-cs-blue hover:bg-cs-green text-steel rounded-l-md px-1 py-8 shadow-md">
        ||
    </button>

    <!--
    <body class="flex justify-center items-center h-screen bg-gray-100">
        <div class="bg-white p-6 rounded shadow-lg">
            <h1 class="text-2xl mb-4">Report a Problem</h1>
            <form action="/submit_workorder" method="post">
                <textarea name="issue" required class="border p-2 w-full rounded" placeholder="Describe your issue..."></textarea>
                <button type="submit" class="mt-2 bg-blue-500 text-white px-4 py-2 rounded">Submit</button>
            </form>
        </div>
    </body>
    -->

    <script>
        const feedbackBox = document.getElementById('feedback-box');
        const feedbackToggle = document.getElementById('feedback-toggle');
        const feedbackText = document.getElementById('feedback-text');
        const submitFeedback = document.getElementById('submit-feedback');
        
        function checkScreenSize() {
            const isLargerThanMD = window.matchMedia('(min-width: 768px)').matches;

            if (isLargerThanMD) {
                feedbackBox.classList.remove('hidden');
                feedbackToggle.classList.remove('right-0');
                feedbackToggle.classList.add('md:right-64', 'right-64'); // Move next to the feedback box
            } else {
                feedbackBox.classList.add('hidden');
                feedbackToggle.classList.remove('md:right-64', 'right-64');
                feedbackToggle.classList.add('right-0');
            }
        }

        // Initial check when the page loads
        checkScreenSize();

        // Listen for window resize events to detect screen size changes
        window.addEventListener('resize', checkScreenSize);

        // Collapse/Expand Feedback Box
        feedbackToggle.addEventListener('click', () => {
            feedbackBox.classList.toggle('hidden');
            // Adjust the position of the toggle tab
            if (feedbackBox.classList.contains('hidden')) {
                feedbackToggle.classList.remove('md:right-64', 'right-64');
                feedbackToggle.classList.add('right-0'); // Move to the far right
                feedbackBox.classList.remove('md:block');
            } else {
                feedbackToggle.classList.remove('right-0');
                feedbackToggle.classList.add('md:right-64', 'right-64'); // Move next to the feedback box
            }
        });

        // Submit Feedback Function
        const submitFeedbackHandler = () => {
            const feedback = feedbackText.value.trim();
            if (feedback) {
                fetch('/submit-feedback', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ feedback, url: "/" + window.location.pathname.split('/').pop() }), // Ensure `feedback` is a valid variable
            })
            .then(async response => {
                if (response.ok) {
                    // Clear the input and thank the user
                    feedbackText.value = ''; // Ensure `feedbackText` is defined
                    submitFeedback.innerText = 'Thank you!'; // Change the button text
                    submitFeedback.classList.remove('bg-cs-blue'); // Remove original color
                    submitFeedback.classList.add('bg-cs-green'); // Add new color (green for success)

                    setTimeout(() => {
                        submitFeedback.innerText = 'Submit'; // Revert the button text after 3 seconds
                        submitFeedback.classList.remove('bg-cs-green'); // Remove green color
                        submitFeedback.classList.add('bg-cs-blue');
                    }, 3000); // 3000ms = 3 seconds
                } else {
                    // Attempt to read the error message from the server
                    const errorData = await response.json();
                    alert(`Error submitting feedback: ${errorData.details || 'Unknown error occurred'}. Please provide these details to Cooper :)`);
                }
            })
            .catch(error => {
                // Log the error for debugging and notify the user
                console.error('Submission error:', error);
                alert('An error occurred. Please try again.');
            });
            }
        };

        // Submit Feedback on Button Click
        submitFeedback.addEventListener('click', submitFeedbackHandler);

        // Submit Feedback on CMD+Enter or CTRL+Enter
        feedbackText.addEventListener('keydown', (event) => {
            if ((event.metaKey || event.ctrlKey) && event.key === 'Enter') {
                submitFeedbackHandler();
            }
        });
    </script>
</body>
{% endblock %}


<!--
                <h2>Blockquote Example</h2>
                <blockquote class="border-l-4 border-cs-blue italic pl-4 text-cs-green">
                    "This is an example of a blockquote. It's perfect for highlighting important points or quotes."
                </blockquote>

                <h2>Code Snippet Example</h2>
                <p>
                    Below is an example of a simple Python function:
                </p>
                <pre class="dark:bg-gray-600 bg-gray-400 rounded-lg p-4 shadow-2xl overflow-auto">
def greet(name):
    return f"Hello, {name}!"

print(greet("World"))
                </pre>


<code class="bg-cs-blue px-1 rounded shadow-lg text-base">

</code>
-->

