{% extends 'base.html' %}
{% block content %}
<body class="bg-gray-100 dark:text-steel text-[#222222]">
    <!-- Blog Post Wrapper -->
    <div class="max-w-screen-md px-4 py-8 mx-auto">
        <!-- Thinner Centered Bar -->
        <div class="dark:bg-[#444444] bg-[#CCCCCC] rounded-3xl shadow-2xl dark:shadow-white p-6 mx-auto">
            <!-- Title Section -->
            <div class="text-center">
                <h1 class="text-6xl font-extrabold leading-tight text-cs-green">
                    Microcontrollers Cheat Sheet
                </h1>
                <h2 class="text-2xl text-bold leading-tight text-cs-green">
                    Click a label below to jump to that section
                </h1>
                 <!-- Separator -->
                <div class="h-px bg-cs-green my-6"></div>
                <a href="#linux" class="inline-block bg-cs-blue hover:bg-blue-700  hover:underline px-4 py-1 rounded-lg font-medium transition-all duration-300 border-[#333333] border">
                    Linux
                </a> >>
                <a href="#arm" class="inline-block bg-cs-blue hover:bg-blue-700 hover:underline px-4 py-1 rounded-lg font-medium transition-all duration-300 border-[#333333] border">
                    ARM
                </a> >>
                <a href="#gdb" class="inline-block bg-cs-blue hover:bg-blue-700 hover:underline px-4 py-1 rounded-lg font-medium transition-all duration-300 border-[#333333] border">
                    GDB
                </a> >>
                <a href="#nano" class="inline-block bg-cs-blue hover:bg-blue-700 hover:underline px-4 py-1 rounded-lg font-medium transition-all duration-300 border-[#333333] border">
                    Nano
                </a> >>
                <a href="#other" class="inline-block bg-cs-blue hover:bg-blue-700 hover:underline px-4 py-1 rounded-lg font-medium transition-all duration-300 border-[#333333] border">
                    Other
                </a>
            </div>

            <!-- Blog Content -->

<div class="h-px bg-cs-green my-6"></div><h1 id="linux" class="text-4xl font-extrabold">Linux Commands</h1><br/>

<h2 class="text-2xl text-bold underline text-cs-green">SSH</h2>
<div class="dark:bg-cs-blue bg-cs-blue rounded-lg p-4 shadow-2xl">
    <p class="leading-relaxed text-lg">Command: ssh </p><br/>
    <p class="leading-relaxed text-lg">Usage: ssh username@server </p><br/>
    <p class="leading-relaxed text-lg">Description: Connects your terminal to another computer's terminal </p>
</div><br/>

<h2 class="text-2xl text-bold underline text-cs-green">CLEAR</h2>
<div class="dark:bg-cs-blue bg-cs-blue rounded-lg p-4 shadow-2xl">
    <p class="leading-relaxed text-lg">Command: clear</p><br/>
    <p class="leading-relaxed text-lg">Usage: clear</p><br/>
    <p class="leading-relaxed text-lg">Description: Clears the old text from your terminal. Does not mess up any configuration.</p>
</div><br/>

<h2 class="text-2xl text-bold underline text-cs-green">LS</h2>
<div class="dark:bg-cs-blue bg-cs-blue rounded-lg p-4 shadow-2xl">
    <p class="leading-relaxed text-lg">Command: ls</p><br/>
    <p class="leading-relaxed text-lg">Usage: ls (or "ls -a" to list hidden files too)</p><br/>
    <p class="leading-relaxed text-lg">Description: List ("LiSt") all files and folders in the current directory</p>
</div><br/>

<h2 class="text-2xl text-bold underline text-cs-green">CAT</h2>
<div class="dark:bg-cs-blue bg-cs-blue rounded-lg p-4 shadow-2xl">
    <p class="leading-relaxed text-lg">Command: cat</p><br/>
    <p class="leading-relaxed text-lg">Usage: cat file_name</p><br/>
    <p class="leading-relaxed text-lg">Description: Prints ("conCATenates") the contents of a file to the terminal.</p>
</div><br/>

<h2 class="text-2xl text-bold underline text-cs-green">MKDIR</h2>
<div class="dark:bg-cs-blue bg-cs-blue rounded-lg p-4 shadow-2xl">
    <p class="leading-relaxed text-lg">Command: mkdir</p><br/>
    <p class="leading-relaxed text-lg">Usage: mkdir new_directory_name</p><br/>
    <p class="leading-relaxed text-lg">Description: Creates a new, empty directory ("MaKe DIRectory") with whatever name you put for new_directory_name</code>.</p>
</div><br/>

<h2 class="text-2xl text-bold underline text-cs-green">CD</h2>
<div class="dark:bg-cs-blue bg-cs-blue rounded-lg p-4 shadow-2xl">
    <p class="leading-relaxed text-lg">Command: cd</p><br/>
    <p class="leading-relaxed text-lg">Usage: cd directory_name</p><br/>
    <p class="leading-relaxed text-lg">Description: Changes your current directory ("Change Directory") to the specified directory name. Paths are relative to your current location (e.x. you can't go from ~/Lab1/screenshots/ into ~/Lab2 by just typing "cd Lab2". You need to go up the chain and find it).</p>
</div><br/>

<h2 class="text-2xl text-bold underline text-cs-green">NANO</h2>
<div class="dark:bg-cs-blue bg-cs-blue rounded-lg p-4 shadow-2xl">
    <p class="leading-relaxed text-lg">Command: nano</p><br/>
    <p class="leading-relaxed text-lg">Usage: nano file_name</p><br/>
    <p class="leading-relaxed text-lg">Description: Runs the Terminal App "Nano," which allows you to edit files. If file_name exists in the current directory, you start editing it. If file_name does not exist in the current directory, nano will create a new file of that name and begin editing it.</p>
</div><br/>

<h2 class="text-2xl text-bold underline text-cs-green">GDB</h2>
<div class="dark:bg-cs-blue bg-cs-blue rounded-lg p-4 shadow-2xl">
    <p class="leading-relaxed text-lg">Command: gdb</p><br/>
    <p class="leading-relaxed text-lg">Usage: gdb executable (where "executable" is the name of the file you want to execute the one with no extension, i.e. not the .s)</p><br/>
    <p class="leading-relaxed text-lg">Description: Runs the terminal app GDB ("Gnu DeBugger"), which allows you to step through and examine code while it is running</p>
</div><br/>

<h2 class="text-2xl text-bold underline text-cs-green">CP</h2>
<div class="dark:bg-cs-blue bg-cs-blue rounded-lg p-4 shadow-2xl">
    <p class="leading-relaxed text-lg">Command: cp</p><br/>
    <p class="leading-relaxed text-lg">Usage: cp file, new_location</p><br/>
    <p class="leading-relaxed text-lg">Description: Copies ("CoPy") a file into a new location. If new_location is a directory, the file is copied exactly. If new_location is a file, the file contents are copied exactly but the name is changed to the new file name.</p><br/>
    <p class="leading-relaxed text-lg">Example: cp makefile ../Lab2</p>
</div><br/>


<div class="h-px bg-cs-green my-6"></div><h1 id="arm" class="text-4xl font-extrabold">ARM Commands</h1><br/>

<h2 class="text-2xl text-bold underline text-cs-green">MOV</h2>
<div class="dark:bg-cs-blue bg-cs-blue rounded-lg p-4 shadow-2xl">
    <p class="leading-relaxed text-lg">Instruction: MOV</p><br/>
    <p class="leading-relaxed text-lg">Usage: MOV destination, number</p><br/>
    <p class="leading-relaxed text-lg">Description: Places ("MOVes") a number into the destination register. If the number is another register, it copies that register's contents into the destination register.</p><br/>
    <p class="leading-relaxed text-lg">Example:</p>
    <pre class="dark:bg-gray-600 bg-gray-400 rounded-lg p-4 shadow-2xl overflow-auto">
        MOV R1, #42     @ Puts the decimal number "42" inside R1
        MOV R3, #0x84   @ Puts the hex number 0x84 (which is 132 in decimal) into R3
        MOV R4, R3      @ Puts the value of R3 (0x84) into R4. Now, both R3 and R4 contain 0x84
        MOV R1, R2      @ A register that has not been modified yet is defaulted to 0...
                        @ ...Here, the value in R1 (42) is replaced by the value in R2 (0). Now R1 holds the value 0
</pre></div><br/>

<h2 class="text-2xl text-bold underline text-cs-green">ADD</h2>
<div class="dark:bg-cs-blue bg-cs-blue rounded-lg p-4 shadow-2xl">
<p class="leading-relaxed text-lg">Instruction: ADD</p><br/>
<p class="leading-relaxed text-lg">Usage: ADD destination, number1, number2</p><br/>
<p class="leading-relaxed text-lg">Description: Adds ("ADDs") number1 and number2 and places the result in the destination register. Note that number1 <a class="italic">must</a> be a register, and number2 can be either a register or a regular number.</p><br/>
<p class="leading-relaxed text-lg">Example:</p>
<pre class="dark:bg-gray-600 bg-gray-400 rounded-lg p-4 shadow-2xl overflow-auto">
    MOV R0, #144
    ADD R1, R0, #40     @ Adds the value in R0 (144) with the value 40. R1 now contains the value 184, and R0 was not changed
    ADD R3, R0, R1      @ Adds the value in R0 (144) with the value in R1 (184). R3 now contains 328, and neither R0 nor R1 were changed
    ADD R3, R3, #0x2A   @ Adds the value in R3 (328) with the hex value 0x2A (42 in decimal) and places the result (370) in R3...
                        @ ... R3 now holds the value 370. The old value of R3 (328) was replaced with the new value.
</pre></div><br/>


<h2 class="text-2xl text-bold underline text-cs-green">SHIFTING</h2>

<p class="leading-relaxed text-lg">Logical Shift Left (LSL): Moves all bits to the left one, and the leftmost bit "falls off" (disappears). The rightmost bit becomes a zero. Example: "101101" becomes "011010"</p><br/>
<p class="leading-relaxed text-lg">Logical Shift Right (LSR): Moves all bits to the right one, and the rightmost bit "falls off". The leftmost bit becomes a zero. Example: "11101" becomes "01110"</p><br/>
<p class="leading-relaxed text-lg">Rotate Right (ROR): Moves all the bits to the right one, and the rightmost bit becomes the leftmost bit. Example: "100001" becomes "110000"</p><br/>

<div class="dark:bg-cs-blue bg-cs-blue rounded-lg p-4 shadow-2xl">
<p class="leading-relaxed text-lg">Instruction: LSL, LSR, or ROR</p><br/>
<p class="leading-relaxed text-lg">Usage: TYPE destination, number, amount</p><br/>
<p class="leading-relaxed text-lg">Example:</p>
<pre class="dark:bg-gray-600 bg-gray-400 rounded-lg p-4 shadow-2xl overflow-auto">
    MOV R3, #0b1101
    LSL R0, R3, #4      @ R0 now contains the value of R3 (0b1100 or 12 in decimal/0xC in hex) shifted to the left by 4 bits. R0 holds 0b11010000 (or 192 in decimal, 0x12 in hex)
    LSR R1, R3, #2      @ R1 now contains the value of R3 shifted to the right by 4 bits. R1 holds 0b11 (or 3 in decimal, 0x3 in hex)
    ROR R2, R3, #12     @ R2 now contains the value of R3 rotated to the right by 12 bits. Remember that the registers are 32 bits long...
                        @  ...R2 now holds 0b00000000110100000000000000000000 (or 13631488 in decimal, 0x00D00000 in hex)
</pre></div><br/>

<div class="h-px bg-cs-green my-6"></div><h1 id="gdb" class="text-4xl font-extrabold">GDB Commands</h1><br/>
<p class="leading-relaxed text-lg">- <code class="bg-cs-blue px-1 rounded shadow-lg text-base">b _start</code>: Creates a "Breakpoint" at the tag "_start", which is from your code. You can replace the _start tag with any other tag to start debugging your program from a different point.</p>
<p class="leading-relaxed text-lg">- <code class="bg-cs-blue px-1 rounded shadow-lg text-base">r</code>: "Runs" to your breakpoint. In this context, it means execute all the built-in code up to the _start tag and prepare to start executing code.</p>
<p class="leading-relaxed text-lg">- <code class="bg-cs-blue px-1 rounded shadow-lg text-base">s</code>: "Steps" over a single line of code. This executes the line and waits for the next command. IMPORTANT NOTE: the command you see listed after running <code class="bg-cs-blue px-1 rounded shadow-lg text-base">s</code> is the NEXT command, so it has not yet been executed. To execute that command, you need to step again.</p>
<p class="leading-relaxed text-lg">- <code class="bg-cs-blue px-1 rounded shadow-lg text-base">i r</code>: Reveals the contents of your registers ("Inspect Registers") in a nice format.</p>
<p class="leading-relaxed text-lg">- <code class="bg-cs-blue px-1 rounded shadow-lg text-base">quit</code>: Exits gdb and returns to the terminal</p>

<p class="leading-relaxed text-lg">These GDB commands will be listed in the <a href="cheat-sheet" class="text-lg text-cs-blue hover:text-blue-700 underline">Command Cheat Sheet</a> for your convenience. You will be using them often. A normal workflow looks like this:</p>
<ol class="list-decimal ml-12 text-lg space-y-2"><li>Start running GDB</li>
<li>Set a breakpoint for _start</li>
<li>Run to the breakpoint</li>
<li>Step a bunch of times until you get to the line you want to check</li>
<li>Inspect the registers to see what numbers they contain at that moment</li>
<li>Step to the next part, inspect again, and so on</li>
<li>Once you get the info you need, exit the debugger</li></ol>

<div class="h-px bg-cs-green my-6"></div><h1 id="nano" class="text-4xl font-extrabold">Nano Commands/Shortcuts</h1><br/>
<p class="leading-relaxed text-lg">You exit Nano with <code class="bg-cs-blue px-1 rounded shadow-lg text-base">CTRL + X</code>. Note that on Mac's, it is still CTRL, not CMD like you might be used to. Control X is used to exit Nano and return back to the terminal. Executing the shortcut will bring up the dialog at the bottom of your screen <code class="bg-cs-blue px-1 rounded shadow-lg text-base">Save modified buffer (ANSWERING "No" WILL DESTROY CHANGES) ?</code>. This is Squilliam Fancypants way of saying "Wanna save your changes?" If you want to save your changes, type <code class="bg-cs-blue px-1 rounded shadow-lg text-base">Y</code>, otherwise, type <code class="bg-cs-blue px-1 rounded shadow-lg text-base">N</code>. This is explained below the prompt. Clicking <code class="bg-cs-blue px-1 rounded shadow-lg text-base">Y</code> does not mean you are done yet. One more prompt will come up, saying <code class="bg-cs-blue px-1 rounded shadow-lg text-base">File Name to write : file_name</code>. Here, you can edit the name of your file (actually just creates a new file with your most recent changes and doesn't save the original), or leave it as-is. 99% of the time, you will just click Enter at this prompt, keeping the same file name and returning to the terminal.</p><br/></p>


<div class="h-px bg-cs-green my-6"></div><h1 id="other" class="text-4xl font-extrabold">Other</h1><br/>
<p class="leading-relaxed text-lg">To compile a file, run the Linux command <code class="bg-cs-blue px-1 rounded shadow-lg text-base">make</code>. IMPORTANT: You need to run <code class="bg-cs-blue px-1 rounded shadow-lg text-base">make</code> after EVERY TIME you change your code. You are only changing the .s file, so to update the executable, you need to compile the updated .s file again. </p><br/>
<p class="leading-relaxed text-lg">To run any executable in the terminal, you type <code class="bg-cs-blue px-1 rounded shadow-lg text-base">./filename</code>, where filename is the name of the executable you are running. Make sure to do <code class="bg-cs-blue px-1 rounded shadow-lg text-base">filename</code> and not <code class="bg-cs-blue px-1 rounded shadow-lg text-base">filename.s</code> or <code class="bg-cs-blue px-1 rounded shadow-lg text-base">filename.o</code>.</p><br/>



        </div>
    </div>

        <!-- Feedback Box -->
    <div id="feedback-box" class="fixed hidden right-0 top-1/2 transform -translate-y-1/2 bg-gray-200 dark:bg-[#444444] border-l-4 border-b-4 border-[#E0E0E0] dark:border-[#3B3B3B] rounded-l-xl shadow-lg w-64 p-4 z-50">
        <h2 class="font-bold text-lg dark:text-white text-gray-800 mb-2 text-center">Feedback</h2>
        <textarea id="feedback-text" class="w-full p-2 border rounded-md dark:bg-[#333333] dark:text-steel text-gray-800" rows="4" placeholder="Feedback, corrections, feature ideas, comments, etc."></textarea>
        <button id="submit-feedback" class="mt-2 w-full bg-cs-blue hover:bg-cs-green text-white py-2 px-4 rounded-md">Submit</button>
    </div>

    <!-- Toggle Tab -->
    <button id="feedback-toggle" class="fixed top-1/2 transform -translate-y-1/2 right-0 md:right-64 bg-cs-blue hover:bg-cs-green text-steel rounded-l-md px-1 py-8 shadow-md">
        ||
    </button>

    <!--
    <body class="flex justify-center items-center h-screen bg-gray-100">
        <div class="bg-white p-6 rounded shadow-lg">
            <h1 class="text-2xl mb-4">Report a Problem</h1>
            <form action="/submit_workorder" method="post">
                <textarea name="issue" required class="border p-2 w-full rounded" placeholder="Describe your issue..."></textarea>
                <button type="submit" class="mt-2 bg-blue-500 text-white px-4 py-2 rounded">Submit</button>
            </form>
        </div>
    </body>
    -->

    <script>
        const feedbackBox = document.getElementById('feedback-box');
        const feedbackToggle = document.getElementById('feedback-toggle');
        const feedbackText = document.getElementById('feedback-text');
        const submitFeedback = document.getElementById('submit-feedback');
        
        function checkScreenSize() {
            const isLargerThanMD = window.matchMedia('(min-width: 768px)').matches;

            if (isLargerThanMD) {
                feedbackBox.classList.remove('hidden');
                feedbackToggle.classList.remove('right-0');
                feedbackToggle.classList.add('md:right-64', 'right-64'); // Move next to the feedback box
            } else {
                feedbackBox.classList.add('hidden');
                feedbackToggle.classList.remove('md:right-64', 'right-64');
                feedbackToggle.classList.add('right-0');
            }
        }

        // Initial check when the page loads
        checkScreenSize();

        // Listen for window resize events to detect screen size changes
        window.addEventListener('resize', checkScreenSize);

        // Collapse/Expand Feedback Box
        feedbackToggle.addEventListener('click', () => {
            feedbackBox.classList.toggle('hidden');
            // Adjust the position of the toggle tab
            if (feedbackBox.classList.contains('hidden')) {
                feedbackToggle.classList.remove('md:right-64', 'right-64');
                feedbackToggle.classList.add('right-0'); // Move to the far right
                feedbackBox.classList.remove('md:block');
            } else {
                feedbackToggle.classList.remove('right-0');
                feedbackToggle.classList.add('md:right-64', 'right-64'); // Move next to the feedback box
            }
        });

        // Submit Feedback Function
        const submitFeedbackHandler = () => {
            const feedback = feedbackText.value.trim();
            if (feedback) {
                fetch('/submit-feedback', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ feedback, url: "/" + window.location.pathname.split('/').pop() }), // Ensure `feedback` is a valid variable
            })
            .then(async response => {
                if (response.ok) {
                    // Clear the input and thank the user
                    feedbackText.value = ''; // Ensure `feedbackText` is defined
                    submitFeedback.innerText = 'Thank you!'; // Change the button text
                    submitFeedback.classList.remove('bg-cs-blue'); // Remove original color
                    submitFeedback.classList.add('bg-cs-green'); // Add new color (green for success)

                    setTimeout(() => {
                        submitFeedback.innerText = 'Submit'; // Revert the button text after 3 seconds
                        submitFeedback.classList.remove('bg-cs-green'); // Remove green color
                        submitFeedback.classList.add('bg-cs-blue');
                    }, 3000); // 3000ms = 3 seconds
                } else {
                    // Attempt to read the error message from the server
                    const errorData = await response.json();
                    alert(`Error submitting feedback: ${errorData.details || 'Unknown error occurred'}. Please provide these details to Cooper :)`);
                }
            })
            .catch(error => {
                // Log the error for debugging and notify the user
                console.error('Submission error:', error);
                alert('An error occurred. Please try again.');
            });
            }
        };

        // Submit Feedback on Button Click
        submitFeedback.addEventListener('click', submitFeedbackHandler);

        // Submit Feedback on CMD+Enter or CTRL+Enter
        feedbackText.addEventListener('keydown', (event) => {
            if ((event.metaKey || event.ctrlKey) && event.key === 'Enter') {
                submitFeedbackHandler();
            }
        });
    </script>
</body>
{% endblock %}
